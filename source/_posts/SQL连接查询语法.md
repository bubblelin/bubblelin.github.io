---
title: SQL连接查询语法
date: 2016-09-25 11:35:54
categories: 数据库  
tags: [SQL]
---

### SQL查询的基本原理

#### 单表查询
* 根据WHERE条件过滤表中的记录，形成中间表（这个中间表对用户是不可见的）；
* 然后根据SELECT的选择列选择相应的列进行返回最终结果。

#### 两表连接查询
* 对两表求积（笛卡尔积）并用ON条件和连接连接类型进行过滤形成中间表；
* 然后根据WHERE条件过滤中间表的记录，并根据SELECT指定的列返回查询结果。

#### 多表连接查询
* 先对第一个和第二个表按照两表连接做查询，然后用查询结果和第三个表做连接查询，以此类推；
* 直到所有的表都连接上为止，最终形成一个中间的结果表；
* 然后根据WHERE条件过滤中间表的记录，并根据SELECT指定的列返回查询结果。

#### 备注 ON 和 WHERE 条件

* ON ：是过滤两个链接表笛卡尔积形成中间表的约束条件。

* WHERE ：在有ON条件的SELECT语句中是过滤中间表的约束条件。在没有ON的单表查询中，是限制物理表或者中间查询结果返回记录的约束。在两表或多表连接中是限制连接形成最终中间表的返回结果的约束。

* 建议：ON只进行连接操作，WHERE只过滤中间表的记录。

---

### 连接查询要点

连接查询是SQL查询的核心，连接查询的连接类型依据实际需求。如果选择不当，非但不能提高查询效率，反而会带来一些逻辑错误或者性能低下的表现。
1. <span style="color:red;">查两表关联列相等的数据用内连接。</span>
2. <span style="color:red;">Col_L是Col_R的子集时用右外连接。</span>
3. <span style="color:red;">Col_R是Col_L的子集时用左外连接。</span>
4. <span style="color:red;">Col_L和Col_R彼此有交集但彼此互不为子集时用全补。</span>
5. <span style="color:red;">求差操作时用联合查询。</span>

---

### SQL的四种连接

#### 内连接（INNER JOIN）    
内联接使用比较运算符（例如：= 、 > 、 <）根据每个表共有的列的值匹配两个表中的行。包括相等联接和自然联接。
* 隐式内连接：没有[INNER JOIN]，形成的中间表为两个表的笛卡尔积

* 显式外连接：一般称为内连接，有[INNER JOIN]，形成的中间表为两个表经过ON条件过滤后的笛卡尔积。


#### 外连接（OUTER JOIN）
外联接可以是左向外联接、右向外联接或完整外部联接。
关键字如下：
* <span style="color:red;">LEFT JOIN</span> 或 <span style="color:red;">LEFT OUTER JOIN</span>  ：左向外联接的结果集包括 LEFT OUTER 子句中指定的左表的所有行，而不仅仅是联接列所匹配的行。如果左表的某行在右表中没有匹配行，则在相关联的结果集行中右表的所有选择列表列均为null。

* <span style="color:red;">RIGHT JOIN</span> 或 <span style="color:red;">RIGHT OUTER JOIN</span> ：右向外联接是左向外联接的反向联接。将返回右表的所有行。如果右表的某行在左表中没有匹配行，则将为左表返回null。

* <span style="color:red;">FULL JOIN</span> 或 <span style="color:red;">FULL OUTER JOIN</span> ：完整外部联接返回左表和右表中的所有行。如果表之间有匹配行，则整个结果集行包含基表的数据值。当某行在另一个表中没有匹配行时，则另一个表的选择列表列包含null。


#### 交叉连接（CROSS JOIN）
交叉联接返回左表中的所有行，左表中的每一行与右表中的所有行组合。交叉联接分显式的和隐式的，均不带ON子句，返回的是两表的乘积,称作笛卡尔积。
* 隐式的交叉连接，没有CROSS JOIN。

* 显式的交叉连接，没有CROSS JOIN。查询结果同隐式。

#### 联合连接（UNION JOIN）
Oracle、MySQL均不支持，其作用是：找出全外连接和内连接之间差异的所有行。这在数据分析中排错中比较常用。也可以利用数据库的集合操作来实现此功能。这是一种很少见的连接方式。

---











































<span style="color:red;"></span>






###
